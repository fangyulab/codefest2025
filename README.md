# 安全求助平台 - Prototype

## 系統架構

### 後端 (Flask)
- 位置: `app.py`
- 運行於: `http://127.0.0.1:5000`
- 資料儲存: 使用 txt 檔案 (users.txt, posts.txt, responses.txt)

### 前端 (React)
- 位置: `frontend.jsx`
- 支援三個主要功能頁面:
  1. 發布求助
  2. 查看求助列表
  3. 地圖顯示 (預留)

## 啟動步驟

### 1. 安裝 Python 套件
```bash
pip install -r requirements.txt --break-system-packages
```

### 2. 啟動後端伺服器
```bash
python app.py
```
後端會在 `http://127.0.0.1:5000` 啟動

### 3. 啟動前端 (開啟 frontend.html)
在瀏覽器中開啟 `frontend.html` 檔案

## 功能說明

### 登入功能
- 輸入任意帳號即可登入
- 系統會自動建立新帳號或載入既有帳號
- 建議測試時開兩個帳號: 例如 `user1` 和 `user2`

### Tab 1: 發布求助
- **求助標題**: 簡短描述問題
- **求助內容**: 詳細說明情況
- **定位**: 格式為 `緯度,經度` (例如: 25.0330,121.5654)
  - 未來將整合自動定位功能
- **緊急程度**:
  - 緊急 (5分鐘內) - 紅色
  - 重要 (15分鐘內) - 橘色
  - 一般 (30分鐘內) - 黃色
- **標籤選擇**:
  - 事發類型: 性騷擾、跟蹤、偷拍等
  - 地點類型: 捷運、廁所、小巷等
  - 系統會自動判斷行政區
- **聯絡方式**: 電話或其他聯絡方式

### Tab 2: 查看求助列表
- **篩選功能**:
  - 所有資訊: 顯示所有未解決的求助
  - 五公里內: 只顯示距離 5 公里內的求助
- **標籤篩選**: 可依事發類型、地點類型、行政區篩選
- **貼文排序**:
  - 自己發布的貼文永遠在最上方
  - 其次按緊急程度排序
  - 最後按發布時間排序
- **點擊貼文**查看詳細資訊:
  - 完整內容
  - 距離資訊
  - 聯絡方式
  - 有多少人正在前往協助
- **互動功能**:
  - 其他使用者: 可點擊「我正在前往協助」
  - 發文者本人: 可標記「已解決」

### Tab 3: 地圖 (預留)
- 將整合地圖 API
- 顯示所有未解決求助的位置點
- 點位顏色對應緊急程度:
  - 紅色: 緊急
  - 橘色: 重要
  - 黃色: 一般

## API 端點

### 1. 登入
```
POST /api/login
Body: { "username": "user1" }
```

### 2. 建立求助貼文
```
POST /api/posts
Body: {
  "user_id": 1,
  "title": "求助標題",
  "content": "求助內容",
  "location": "25.0330,121.5654",
  "urgency": 1,
  "contact": "0912345678",
  "labels": ["性騷擾", "捷運"]
}
```

### 3. 取得貼文列表
```
GET /api/posts?user_id=1&location=25.0330,121.5654&distance=5&label=性騷擾
```

### 4. 取得單一貼文詳情
```
GET /api/posts/1?location=25.0330,121.5654
```

### 5. 標記貼文為已解決
```
POST /api/posts/1/resolve
Body: { "user_id": 1 }
```

### 6. 回應求助 (表示正在前往)
```
POST /api/posts/1/respond
Body: { "user_id": 2 }
```

### 7. 取得標籤選項
```
GET /api/labels
```

### 8. 取得地圖資料
```
GET /api/map
```

## 資料結構

### users.txt
```json
[
  {
    "id": 1,
    "username": "user1",
    "created_at": "2024-11-08T10:00:00"
  }
]
```

### posts.txt
```json
[
  {
    "id": 1,
    "user_id": 1,
    "title": "求助標題",
    "content": "求助內容",
    "labels": ["性騷擾", "捷運"],
    "location": "25.0330,121.5654",
    "latitude": 25.0330,
    "longitude": 121.5654,
    "urgency": 1,
    "contact": "0912345678",
    "resolved": false,
    "created_at": "2024-11-08T10:00:00",
    "helper_count": 0
  }
]
```

### responses.txt
```json
[
  {
    "id": 1,
    "post_id": 1,
    "user_id": 2,
    "created_at": "2024-11-08T10:05:00"
  }
]
```

## 測試流程建議

1. 開啟兩個瀏覽器視窗 (或使用無痕模式)
2. 視窗 1: 登入為 `user1` (求助者)
3. 視窗 2: 登入為 `user2` (協助者)
4. 在視窗 1 中發布一則求助
5. 在視窗 2 的列表中應該會看到這則求助
6. 在視窗 2 中點擊「我正在前往協助」
7. 切換回視窗 1，重新整理或查看貼文，會看到有 1 人正在前往
8. 在視窗 1 中點擊「標記為已解決」
9. 貼文會從列表中消失

## 待整合功能

- [ ] 自動定位功能 (替代手動輸入經緯度)
- [ ] 地圖 API 整合 (Google Maps 或其他)
- [ ] 台北通帳號登入串接
- [ ] 推播通知功能
- [ ] 聊天功能

## 注意事項

- 本系統為原型版本，使用 txt 檔案儲存資料
- 正式環境需要替換為真實資料庫 (如 PostgreSQL, MongoDB)
- 位置計算使用 Haversine 公式，精確度足夠但未考慮道路實際距離
- 目前無身份驗證機制，僅用於原型測試
